using HomeAPI.Backend.Models.TimeSeries;
using HomeAPI.Backend.Models.TimeSeries.InfluxDB;
using Xunit;

namespace HomeAPI.Backend.Tests.Models.TimeSeries.InfluxDB
{
	public class InfluxDBQueryResultParserTests
	{
		#region ParseQueryResult

		[Fact]
		public void ParseQueryResult()
		{
			string queryResult = "#datatype,string,long,dateTime:RFC3339,dateTime:RFC3339,dateTime:RFC3339,double,string,string,string\r\n#group,false,false,true,true,false,false,true,true,true\r\n#default,_result,,,,,,,,\r\n,result,table,_start,_stop,_time,_value,_field,_measurement,location\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T20:32:06.654607268Z,11.72,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T21:02:06.601334822Z,11.54,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T21:32:06.61243966Z,11.39,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T22:02:06.619012668Z,11.17,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T22:32:06.629665873Z,11.15,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T23:02:06.611937092Z,11.15,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-30T23:32:06.611058879Z,11.14,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T00:02:06.64483666Z,10.74,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T00:32:06.633032699Z,10.74,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T01:02:06.697801963Z,10.74,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T01:32:06.627959818Z,10.75,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T02:02:06.644334048Z,10.74,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T02:32:06.669014804Z,10.75,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T03:02:06.67524846Z,10.37,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T03:32:06.681828817Z,10.37,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T04:02:06.723166755Z,10.37,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T04:32:06.700394407Z,10.37,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T05:02:06.724129164Z,10.18,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T05:32:06.762928409Z,9.79,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T06:02:06.766367449Z,9.62,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T06:32:06.763738588Z,9.62,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T07:02:06.787685202Z,9.81,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T07:32:06.775200538Z,10.39,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T08:02:06.789876112Z,10.95,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T08:32:06.809129276Z,10.97,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T09:02:06.803287855Z,11.33,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T09:32:06.80228681Z,11.88,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T10:02:06.823634766Z,11.99,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T10:32:06.821981393Z,12.41,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T11:02:06.836726806Z,12.41,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T11:32:06.850880919Z,12.98,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T12:02:06.840523253Z,12.58,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T12:32:06.910322449Z,13.14,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T13:02:06.874191657Z,13.51,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T13:32:06.874316136Z,13.14,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T14:02:06.904026256Z,13.33,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T14:32:06.963744424Z,13.27,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T15:02:06.973014666Z,13.27,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T15:32:06.978883107Z,13.18,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T16:02:07.044757089Z,12.28,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T16:32:07.004080468Z,11.82,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T17:02:07.028722518Z,11.29,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T17:32:07.059545984Z,10.46,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T18:02:07.901978091Z,10.35,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T18:32:07.068681302Z,10.13,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T19:11:11.044811443Z,10.02,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T19:41:10.998393193Z,10.34,value,temperature,Room1\r\n,,0,2020-10-30T20:24:09.234862078Z,2020-10-31T20:24:09.234862078Z,2020-10-31T20:11:11.000419996Z,9.96,value,temperature,Room1\r\n\r\n";
			InfluxDBQueryResultParser parser = new InfluxDBQueryResultParser();

			var result = parser.ParseQueryResult(queryResult, TimeSeriesValueType.Float);

			Assert.Equal(48, result.Count);
			Assert.Equal(11.72f, (result[0] as DataPoint<float>).Value);
		}

		#endregion
	}
}